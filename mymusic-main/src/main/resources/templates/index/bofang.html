<!DOCTYPE html>
<html lang="en" class="app" xmlns:th="http://www.thymeleaf.org" taglib>

<head>
    <meta charset="utf-8" />
    <title>Musik | Web Application</title>
    <meta name="description" content="app, web app, responsive, admin dashboard, admin, flat, flat ui, ui kit, off screen nav" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <link rel="stylesheet" th:href="@{js/jPlayer/jplayer.flat.css}" type="text/css" />
    <link rel="stylesheet" th:href="@{css/bootstrap.css}" type="text/css" />
    <link rel="stylesheet" th:href="@{css/animate.css}" type="text/css" />
    <link rel="stylesheet" th:href="@{css/font-awesome.min.css}" type="text/css" />
    <link rel="stylesheet" th:href="@{css/simple-line-icons.css}" type="text/css" />
    <link rel="stylesheet" th:href="@{css/font.css}" type="text/css" />
    <link rel="stylesheet" th:href="@{css/app.css}" type="text/css" />


    <link rel="stylesheet" th:href="@{song_js/css/style.css}" />
    <link rel="stylesheet" th:href="@{song_js/css/styles.css}" />
    <link rel="stylesheet" th:href="@{css/bootstrap.css}" />
    <link rel="stylesheet" th:href="@{css/bootstrap.min.css}" />
    <style>
        .hei {
          height: 0px;
        }
    </style>
    <!--[if lt IE 9]>
    <script th:src="@{js/ie/html5shiv.js}"></script>
    <script th:src="@{js/ie/respond.min.js}"></script>
    <script th:src="@{js/ie/excanvas.js}"></script>
    <![endif]-->
</head>

<body class="" onload="pageChange(1)">
<section class="vbox">
    <header class="bg-black lter header header-md navbar navbar-fixed-top-xs">
        <div class="navbar-header aside bg-success nav-xs" style="background-color: #8ca1af;height: 60px">
            <a class="btn btn-link visible-xs" data-toggle="class:nav-off-screen,open" data-target="#nav,html">
                <i class="icon-list"></i>
            </a>
            <input type="hidden" th:value="${song.name}" id="songName">
            <input type="hidden" th:value="${song.id}" id="songId">
            <input type="hidden" th:value="${song.album}" id="songAlbum">
            <input type="hidden" th:value="${song.singer}" id="songSinger">
            <input type="hidden" th:value="${song.pic}" id="songPicture">
            <input type="hidden" th:value="${song.url}" id="songUrl">
            <a th:href="@{member}" class="navbar-brand text-lt" style="margin-left: 25px">
                <i class="icon-earphones"></i>
                <img  th:src="@{images/logo.png}" alt="." class="hide">
                <span class="hidden-nav-xs m-l-sm">Music</span>
            </a>
            <a class="btn btn-link visible-xs" data-toggle="dropdown" data-target=".user">
                <i class="icon-settings"></i>
            </a>
        </div>
        <ul class="nav navbar-nav hidden-xs">
            <li>
                <a href="#nav,.navbar-header" data-toggle="class:nav-xs,nav-xs" class="text-muted">
                    <i class="fa fa-indent text"></i>
                    <i class="fa fa-dedent text-active"></i>
                </a>
            </li>
        </ul>

        <div class="navbar-right ">
            <ul class="nav navbar-nav m-n hidden-xs nav-user user">
                <li class="hidden-xs">

                    <section class="dropdown-menu aside-xl animated fadeInUp">
                        <section class="panel bg-white">
                            <div class="panel-heading b-light bg-light">
                                <strong>You have <span class="count">2</span> notifications</strong>
                            </div>
                            <div class="list-group list-group-alt">
                                <a href="#" class="media list-group-item">
											<span class="pull-left thumb-sm">
                      <img src="images/a0.png" alt="..." class="img-circle">
                    </span>
                                    <span class="media-body block m-b-none">
                      Use awesome animate.css<br>
                      <small class="text-muted">10 minutes ago</small>
                    </span>
                                </a>
                                <a href="#" class="media list-group-item">
											<span class="media-body block m-b-none">
                      1.0 initial released<br>
                      <small class="text-muted">1 hour ago</small>
                    </span>
                                </a>
                            </div>
                            <div class="panel-footer text-sm">
                                <a href="#" class="pull-right"><i class="fa fa-cog"></i></a>
                                <a href="#notes" data-toggle="class:show animated fadeInRight">See all the notifications</a>
                            </div>
                        </section>
                    </section>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle bg clear" data-toggle="dropdown">
								<span class="thumb-sm avatar pull-right m-t-n-sm m-b-n-sm m-l-sm">
                <img src="images/a0.png" alt="...">
              </span> <span id="userSpan" th:text="${session.User.username}"></span> <b  class="caret"></b>
                    </a>
                    <ul class="dropdown-menu animated fadeInRight">
                        <li>
                            <a th:href="@{toGeRenXinXi}">个人信息</a>
                        </li>
                        <li>
                            <a th:href="@{toAddUserMusic}">上传歌曲</a>
                        </li>
                        <hr>
                        <li>
                            <a th:href="@{logout}" >注销</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </header>
    <section>
        <section class="hbox stretch">
            <!-- .aside -->
            <aside class="bg-black dk nav-xs aside hidden-print" id="nav">
                <section class="vbox">
                    <section class="w-f-md scrollable">
                        <div class="slim-scroll" data-height="auto" data-disable-fade-out="true" data-distance="0" data-size="10px" data-railOpacity="0.2">

                            <!-- nav -->
                            <nav class="nav-primary hidden-xs">
                                <ul class="nav bg clearfix">
                                    <li class="hidden-nav-xs padder m-t m-b-sm text-xs text-muted">
                                        推荐
                                    </li>
                                    <li>
                                        <a th:href="@{member}">
                                            <i class="icon-disc icon text-success"></i>
                                            <span class="font-bold">发现音乐</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a th:href="@{toMusic}">
                                            <i class="icon-music-tone-alt icon text-info"></i>
                                            <span class="font-bold">音乐</span>
                                        </a>
                                    </li>

                                    <li>
                                        <a th:href="@{toSinger}" data-target="#content" data-el="#bjax-el" data-replace="true">
                                            <i class="icon-social-youtube icon  text-primary"></i>
                                            <span class="font-bold">歌手</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a th:href="@{toTuiJian}">
                                            <i class="icon-drawer icon text-primary-lter"></i>
                                            <span class="font-bold">推荐</span>
                                        </a>
                                    </li>

                                    <li class="m-b hidden-nav-xs"></li>
                                </ul>

                            </nav>
                            <!-- / nav -->
                        </div>
                    </section>
                    <footer >
                        <a th:href="@{downLoadMusic(id=${song.id})}"><img src="images/xiazai.png" width="50px"  height="50px" alt="" style="margin: 0 0 10px 10px"></a>
                    </footer>
                </section>
            </aside>
            <!-- /.aside -->
            <section id="content">
                <section class="vbox">
                    <section class="scrollable" style="background-color:#f2f4f4">
                        <div id="example-wrapper">
                            <!--<ul id="example-size-picker">
                        <span>sadasdnasidjh</span>
                        </ul>-->

                            <div id="example-outer">
                                <div id="example" data-size="full">

                                </div>
                            </div>
                        </div>
                        <div style="width: 100%; height: auto;background-color: #efefef;padding-top: 70px;">
                            <div style="width: 80%; height: auto;margin-left: 10%;background-color: #FFF">
                                <div class="container-fluid">
                                    <div class="row">
                                        <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12">
                                            <form id="addForm">
                                                <h2><span class="glyphicon glyphicon-plus" aria-hidden="true"></span>评论</h2>
                                                <hr />
                                                <div class="form-group">
                                                    <label for="fcontent" style="font-family: '宋体';font-size: 15px;">评论内容：
                                                        <textarea class="form-control" style="resize:none" id="fcontent" cols="100" rows="10" name="content" placeholder="请发表您的想法..."></textarea>
                                                    </label>
                                                </div>
                                                <button type="button" class="btn btn-success" id="subBtn" style="width: 100px;font-size: 15px;">发表</button>
                                            </form>
                                        </div>

                                        <div class="col-md-3 col-md-12 col-sm-12 col-xs-12">
                                            <h3>评论指南</h3> 请使用精简的语言发表您的评论
                                        </div>
                                    </div>
                                    <div style="height: 100%;margin-top: 100px;">
                                        <div class="media" style="margin-bottom: 12px;background-color: #efefec" id="comment-div">

                                        </div>
                                        <div style="width:100%; border:1px solid #8ca1af;"></div>
                                        <tfoot >
                                        <tr>
                                            <td colspan="6" align="center">
                                                <ul class="pagination" style="margin-left: 33%;">

                                                </ul>
                                            </td>
                                        </tr>

                                        </tfoot>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </section>
                </section>
            </section>
        </section>
    </section>
</section>


<script th:src="@{js/jquery.min.js}"></script>
<!-- Bootstrap -->
<script th:src="@{js/bootstrap.js}"></script>
<!-- App -->
<script th:src="@{js/app.js}"></script>
<script th:src="@{js/slimscroll/jquery.slimscroll.min.js}"></script>
<script th:src="@{js/app.plugin.js}"></script>
<script type="text/javascript" th:src="@{js/jPlayer/jquery.jplayer.min.js}"></script>
<script type="text/javascript" th:src="@{js/jPlayer/add-on/jplayer.playlist.min.js}"></script>
<script type="text/javascript" th:src="@{js/jPlayer/demo.js}"></script>

<script th:src="@{song_js/images/jquery.min.js}"></script>
<script th:src="@{song_js/js/ttw-clarity-player.js}"></script>
<script th:src="@{song_js/js/yepnope.js}"></script>
<script th:src="@{backstage/jquery/layer/layer.js}"></script>
<script type="text/javascript">




    // <input type="hidden" th:value="${song.name}" id="songName">
    //     <input type="hidden" th:value="${song.album}" id="songAlbum">
    //     <input type="hidden" th:value="${song.singer}" id="songSinger">
    //     <input type="hidden" th:value="${singer.picture}" id="singerPicture">
    //     <input type="hidden" th:value="${song.url}" id="songUrl">
    var userSpan = $("#userSpan").text();
    var songName=$("#songName").val();
    var songId=$("#songId").val();
    var songSinger=$("#songSinger").val();
    var songPicture=$("#songPicture").val();
    var songUrl=$("#songUrl").val();
    var mp3Url='song_js/playlist/'+songUrl;
    var picUrl='song_js/playlist/covers/'+songPicture;


    var obj = [{
        mp3: mp3Url,
        cover: picUrl,
        title: songName,
        artist: songSinger,
    }
    ]
    $(function() {
        var myPlaylist = [
            obj[0]
        ];

        var clarity = $('#example').ttwClarityPlayer(myPlaylist, {
            jPlayer: {
                supplied: 'mp3',
                errorAlerts: true,
                autoPlay: true,
                warningAlerts: true,
                consoleAlerts: true
            }
        });

        $('#example-size-picker').on('click', 'li', function() {
            $('#example').attr('data-size', $(this).data('size'));
            clarity.manageLayout();
        });
    });
    // var album_cover=document.getElementsByClassName("album-cover");
    // console.log(album_cover);
    // album_cover[0].onload= function () {
    //     album_cover[0].className="album-cover hei";
    // }

    function pageChange(pageno) {
        //window.location.href="${APP_PATH}/user/userList.do?pageno="+pageno
        queryPageUser(pageno);
    }

    var jsonObj = {
        "pageno": 1,
        "pagesize": 10,
        "id" : songId
    }

    var loadingIndex = -1;

    function queryPageUser(pageno) {
        jsonObj.pageno = pageno;
        $
            .ajax({
                type: "POST",
                data: jsonObj,
                url: "commentBySongName",
                beforeSend: function () {
                    loadingIndex = layer.load(2, {
                        time: 10 * 1000
                    });
                    return true;
                },
                success: function (result) {
                    layer.close(loadingIndex);
                    if (result.success) {
                        var page = result.page;
                        var data = page.datas;

                        var content = '';

                        $.each(data, function (i, n) {

                            content += '<div class="media-left" style="margin-bottom: 100px;padding-left: 100px;"><br>';

                            content += '  <h2>'
                                + n.username
                                + '：</h2>';
                            content += '<h4 class=" col-md-9 col-md-offset-2">'
                                + n.content
                                + '</h4>';
                            content += '  </div>';

                        });

                        $("#comment-div").html(content);

                        var contentBar = '';

                        if (page.pageno == 1) {
                            contentBar += '<li class="disabled"><a href="#">上一页</a></li>';
                        } else {
                            contentBar += '<li><a href="#" onclick="pageChange('
                                + (pageno - 1) + ')">上一页</a></li>';
                        }

                        for (var i = 1; i <= page.totalno; i++) {
                            contentBar += '<li ';
                            if (page.pageno == i) {
                                contentBar += 'class="active"';
                            }
                            contentBar += '><a href="#" onclick="pageChange('
                                + i + ')">' + i + '</a></li>';
                        }

                        if (page.pageno == page.totalno) {
                            contentBar += '<li class="disabled"><a href="#" >下一页</a></li>';
                        } else {
                            contentBar += '<li><a href="#" onclick="pageChange('
                                + (pageno + 1) + ')">下一页</a></li>';
                        }

                        $(".pagination").html(contentBar);

                    } else {
                        layer.msg(result.msg, {
                            time: 1000,
                            icon: 5,
                            shift: 6
                        });
                    }
                },
                error: function () {
                    layer.msg("加载失败", {
                        time: 1000,
                        icon: 5,
                        shift: 6
                    });
                }

            });
    }

    $("#subBtn").click(function () {

        var fcontent = $("#fcontent")

        $.ajax({
            type: "POST",
            data: {
                "username": userSpan,
                "content": fcontent.val(),
                "songId": songId,

            },
            url: "doAddContent",
            beforeSend: function () {
                return true;
            },
            success: function (result) {
                if (result.success) {
                    pageChange(1)
                    fcontent.val("");
                }
            },
            error: function () {
                layer.msg("保存失败！", {time: 1000, icon: 5, shift: 6});
            },

        });

    });

    function downloadMusic() {
        window.location.href = "downLoadMusic?id" + songId;
    }
</script>


</body>

</html>